<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architettura AWS - Mappa Servizi e Collegamenti</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        h1 {
            color: #2d3748;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #4a5568;
            margin-top: 30px;
            border-left: 4px solid #764ba2;
            padding-left: 10px;
        }
        .diagram-container {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .legend-item {
            padding: 10px;
            background: #edf2f7;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .service-card {
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        .service-card h3 {
            color: #667eea;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .service-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .connection-list {
            background: #f8fafc;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }
        .connection-list li {
            margin: 5px 0;
            color: #4a5568;
        }
        .flow-section {
            background: #fef5e7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #f39c12;
        }
        code {
            background: #2d3748;
            color: #48bb78;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            border-bottom: 2px solid #e2e8f0;
        }
        .tab {
            padding: 10px 20px;
            background: #f7fafc;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
        }
        .tab.active {
            background: #667eea;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèóÔ∏è Architettura AWS - Assistenza Tecnica AI</h1>
        <p><strong>Mappa completa dei servizi AWS e delle loro interconnessioni</strong></p>

        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Overview Generale</button>
            <button class="tab" onclick="showTab('data-flow')">Flusso Dati</button>
            <button class="tab" onclick="showTab('ml-pipeline')">Pipeline ML</button>
            <button class="tab" onclick="showTab('security')">Security & Network</button>
        </div>

        <!-- TAB 1: Overview Generale -->
        <div id="overview" class="tab-content active">
            <h2>üìä Vista d'Insieme - Tutti i Servizi</h2>
            <div class="diagram-container">
                <div class="mermaid">
                graph TB
                    %% External Layer
                    subgraph "üåê External"
                        USER[fa:fa-users Users]
                        ITSM[fa:fa-ticket ITSM System]
                        WIKI[fa:fa-book Corporate Wiki]
                    end

                    %% Entry Points
                    subgraph "üö™ Entry Points"
                        CF[CloudFront CDN]
                        R53[Route 53 DNS]
                        ALB[Application Load Balancer]
                        APIGW[API Gateway]
                    end

                    %% Auth & Security
                    subgraph "üîê Auth & Security"
                        COG[Cognito User Pools]
                        WAF[AWS WAF]
                        SEC[Secrets Manager]
                        KMS[KMS Encryption]
                    end

                    %% Compute Layer
                    subgraph "‚öôÔ∏è Compute"
                        LAMBDA1[Lambda: API Handlers]
                        LAMBDA2[Lambda: Processors]
                        LAMBDA3[Lambda: Validators]
                        SFN[Step Functions]
                        BATCH[AWS Batch]
                    end

                    %% ML/AI Services
                    subgraph "ü§ñ ML/AI Services"
                        BEDROCK[Amazon Bedrock]
                        SM_END[SageMaker Endpoints]
                        SM_PIPE[SageMaker Pipelines]
                        SM_REG[Model Registry]
                        TEXTRACT[Amazon Textract]
                        COMPREHEND[Comprehend Medical]
                    end

                    %% Storage & Database
                    subgraph "üíæ Storage & Database"
                        S3_RAW[S3: Raw Data]
                        S3_PROC[S3: Processed]
                        S3_MODEL[S3: Models]
                        DDB_STATE[DynamoDB: State]
                        DDB_IDEM[DynamoDB: Idempotency]
                        OS[OpenSearch Domain]
                        RDS[RDS PostgreSQL]
                    end

                    %% Integration & Messaging
                    subgraph "üì¨ Integration"
                        SQS1[SQS: Ticket Queue]
                        SQS2[SQS: DLQ]
                        SNS[SNS Topics]
                        EB[EventBridge]
                        KINESIS[Kinesis Data Streams]
                    end

                    %% Monitoring
                    subgraph "üìà Monitoring"
                        CW[CloudWatch]
                        XRAY[X-Ray Tracing]
                        CT[CloudTrail]
                    end

                    %% Connections
                    USER --> CF
                    CF --> ALB
                    ALB --> APIGW
                    R53 --> CF
                    
                    APIGW --> WAF
                    WAF --> LAMBDA1
                    LAMBDA1 --> COG
                    
                    LAMBDA1 --> SFN
                    SFN --> LAMBDA2
                    SFN --> LAMBDA3
                    
                    ITSM --> SQS1
                    SQS1 --> LAMBDA2
                    WIKI --> S3_RAW
                    
                    LAMBDA2 --> TEXTRACT
                    TEXTRACT --> S3_PROC
                    
                    SFN --> SM_END
                    SFN --> BEDROCK
                    
                    SM_PIPE --> SM_REG
                    SM_REG --> SM_END
                    
                    LAMBDA2 --> DDB_STATE
                    LAMBDA1 --> DDB_IDEM
                    
                    S3_PROC --> OS
                    BEDROCK --> OS
                    
                    SFN --> EB
                    EB --> SNS
                    SNS --> LAMBDA3
                    
                    LAMBDA2 --> KINESIS
                    KINESIS --> CW
                    
                    LAMBDA1 --> XRAY
                    LAMBDA2 --> XRAY
                    SFN --> CW
                    
                    SEC --> LAMBDA1
                    KMS --> S3_RAW
                    KMS --> DDB_STATE
                    
                    SM_END --> CW
                    BEDROCK --> CW
                    
                    BATCH --> SM_PIPE
                    
                    DDB_STATE --> RDS
                    
                    SQS1 --> SQS2
                    
                    style USER fill:#e8f5e9
                    style ITSM fill:#e8f5e9
                    style WIKI fill:#e8f5e9
                    style BEDROCK fill:#fff3e0
                    style SM_END fill:#fff3e0
                    style SFN fill:#e3f2fd
                    style DDB_STATE fill:#fce4ec
                    style OS fill:#fce4ec
                    style S3_RAW fill:#fce4ec
                </div>
            </div>
        </div>

        <!-- TAB 2: Flusso Dati -->
        <div id="data-flow" class="tab-content">
            <h2>üîÑ Flusso Dati Dettagliato</h2>
            <div class="diagram-container">
                <div class="mermaid">
                graph LR
                    subgraph "üì• Ingestion"
                        TICKET[New Ticket]
                        DOC[Document Upload]
                        LOG[System Logs]
                    end

                    subgraph "üîÑ Processing Pipeline"
                        VAL{Validation}
                        ENRICH[Data Enrichment]
                        OCR[OCR Processing]
                        CLEAN[Cleaning]
                        CHUNK[Chunking]
                        EMBED[Embedding]
                    end

                    subgraph "üíæ Storage Layers"
                        BRONZE[(Bronze: Raw)]
                        SILVER[(Silver: Cleaned)]
                        GOLD[(Gold: Analytics)]
                    end

                    subgraph "üéØ Destination"
                        KB[Knowledge Base]
                        TRAIN[Training Data]
                        CACHE[Response Cache]
                    end

                    TICKET --> VAL
                    DOC --> VAL
                    LOG --> VAL
                    
                    VAL -->|Valid| ENRICH
                    VAL -->|Invalid| DLQ[Dead Letter Queue]
                    
                    ENRICH --> BRONZE
                    BRONZE --> OCR
                    OCR --> CLEAN
                    CLEAN --> SILVER
                    SILVER --> CHUNK
                    CHUNK --> EMBED
                    EMBED --> GOLD
                    
                    GOLD --> KB
                    GOLD --> TRAIN
                    GOLD --> CACHE
                    
                    style BRONZE fill:#cd7f32
                    style SILVER fill:#c0c0c0
                    style GOLD fill:#ffd700
                </div>
            </div>
        </div>

        <!-- TAB 3: ML Pipeline -->
        <div id="ml-pipeline" class="tab-content">
            <h2>ü§ñ Pipeline Machine Learning</h2>
            <div class="diagram-container">
                <div class="mermaid">
                graph TB
                    subgraph "üìä Data Preparation"
                        HIST[Historical Tickets]
                        LABEL[Manual Labels]
                        AUG[Data Augmentation]
                    end

                    subgraph "üî¨ Training Pipeline"
                        SPLIT[Train/Val/Test Split]
                        FE[Feature Engineering]
                        TRAIN_CLS[Train Classifier]
                        TRAIN_EMB[Train Embeddings]
                        EVAL[Evaluation]
                        REG[Model Registry]
                    end

                    subgraph "üöÄ Deployment"
                        STAGING[Staging Endpoint]
                        CANARY[Canary Deploy]
                        PROD[Production Endpoint]
                        AB[A/B Testing]
                    end

                    subgraph "üîÑ Continuous Learning"
                        FEEDBACK[User Feedback]
                        MONITOR[Performance Monitor]
                        DRIFT[Drift Detection]
                        RETRAIN[Auto Retrain]
                    end

                    HIST --> SPLIT
                    LABEL --> SPLIT
                    AUG --> SPLIT
                    
                    SPLIT --> FE
                    FE --> TRAIN_CLS
                    FE --> TRAIN_EMB
                    
                    TRAIN_CLS --> EVAL
                    TRAIN_EMB --> EVAL
                    
                    EVAL -->|Pass| REG
                    EVAL -->|Fail| FE
                    
                    REG --> STAGING
                    STAGING --> CANARY
                    CANARY --> AB
                    AB --> PROD
                    
                    PROD --> MONITOR
                    FEEDBACK --> MONITOR
                    MONITOR --> DRIFT
                    DRIFT -->|Detected| RETRAIN
                    RETRAIN --> SPLIT
                    
                    style REG fill:#4caf50
                    style PROD fill:#2196f3
                    style DRIFT fill:#ff9800
                </div>
            </div>
        </div>

        <!-- TAB 4: Security -->
        <div id="security" class="tab-content">
            <h2>üîí Security & Network Architecture</h2>
            <div class="diagram-container">
                <div class="mermaid">
                graph TB
                    subgraph "üåç Internet"
                        INET[Internet Traffic]
                    end

                    subgraph "üõ°Ô∏è Edge Security"
                        SHIELD[AWS Shield]
                        CFWAF[CloudFront + WAF]
                    end

                    subgraph "üè∞ VPC Architecture"
                        subgraph "Public Subnets"
                            NAT[NAT Gateway]
                            ALBPUB[ALB]
                        end
                        
                        subgraph "Private Subnets"
                            LAMBDA_PR[Lambda Functions]
                            ECS[ECS Fargate]
                        end
                        
                        subgraph "Data Subnets"
                            RDS_PR[RDS Multi-AZ]
                            OS_PR[OpenSearch]
                            CACHE[ElastiCache]
                        end
                    end

                    subgraph "üîë Security Services"
                        IAM[IAM Roles]
                        SSM[Systems Manager]
                        GUARD[GuardDuty]
                        MACIE[Macie]
                    end

                    subgraph "üîê Encryption"
                        KMS_DATA[KMS Data Keys]
                        KMS_APP[KMS App Keys]
                        ACM[ACM Certificates]
                    end

                    INET --> SHIELD
                    SHIELD --> CFWAF
                    CFWAF --> ALBPUB
                    
                    ALBPUB --> LAMBDA_PR
                    LAMBDA_PR --> NAT
                    NAT --> INET
                    
                    LAMBDA_PR --> RDS_PR
                    LAMBDA_PR --> OS_PR
                    LAMBDA_PR --> CACHE
                    
                    IAM --> LAMBDA_PR
                    SSM --> ECS
                    
                    GUARD --> LAMBDA_PR
                    MACIE --> RDS_PR
                    
                    KMS_DATA --> RDS_PR
                    KMS_DATA --> OS_PR
                    KMS_APP --> LAMBDA_PR
                    ACM --> ALBPUB
                    
                    style SHIELD fill:#ff5722
                    style CFWAF fill:#ff9800
                    style IAM fill:#4caf50
                    style KMS_DATA fill:#9c27b0
                </div>
            </div>
        </div>

        <h2>üîó Dettaglio Collegamenti tra Servizi</h2>
        
        <div class="service-grid">
            <!-- API Gateway -->
            <div class="service-card">
                <h3><span class="service-icon">AG</span> API Gateway</h3>
                <strong>Input:</strong>
                <ul>
                    <li>HTTP/REST requests da ALB</li>
                    <li>WebSocket connections</li>
                    <li>JWT tokens da Cognito</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí Lambda (sync invoke)</li>
                    <li>‚Üí Step Functions (async)</li>
                    <li>‚Üí SQS (direct integration)</li>
                    <li>‚Üí DynamoDB (direct)</li>
                </ul>
                <div class="connection-list">
                    <strong>Configurazione:</strong>
                    <li>Request validation schemas</li>
                    <li>Rate limiting: 10K req/sec</li>
                    <li>Caching: 5min TTL</li>
                </div>
            </div>

            <!-- Step Functions -->
            <div class="service-card">
                <h3><span class="service-icon">SF</span> Step Functions</h3>
                <strong>Input:</strong>
                <ul>
                    <li>API Gateway triggers</li>
                    <li>EventBridge rules</li>
                    <li>SQS messages</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí Lambda (task states)</li>
                    <li>‚Üí SageMaker (jobs)</li>
                    <li>‚Üí Bedrock (invoke)</li>
                    <li>‚Üí DynamoDB (update)</li>
                    <li>‚Üí SNS (notifications)</li>
                </ul>
                <div class="connection-list">
                    <strong>State Machine:</strong>
                    <li>Max duration: 1 year</li>
                    <li>Express workflows per sync</li>
                    <li>Standard per async</li>
                </div>
            </div>

            <!-- Lambda Functions -->
            <div class="service-card">
                <h3><span class="service-icon">Œª</span> Lambda Functions</h3>
                <strong>Input:</strong>
                <ul>
                    <li>API Gateway (sync)</li>
                    <li>SQS (poll-based)</li>
                    <li>EventBridge (events)</li>
                    <li>S3 (triggers)</li>
                    <li>DynamoDB Streams</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí DynamoDB (SDK)</li>
                    <li>‚Üí S3 (SDK)</li>
                    <li>‚Üí Bedrock (SDK)</li>
                    <li>‚Üí OpenSearch (HTTP)</li>
                    <li>‚Üí SQS/SNS (SDK)</li>
                </ul>
                <div class="connection-list">
                    <strong>Config:</strong>
                    <li>Memory: 512MB-3GB</li>
                    <li>Timeout: 15min max</li>
                    <li>Concurrency: 1000</li>
                    <li>VPC: Private subnets</li>
                </div>
            </div>

            <!-- Bedrock -->
            <div class="service-card">
                <h3><span class="service-icon">AI</span> Amazon Bedrock</h3>
                <strong>Input:</strong>
                <ul>
                    <li>Step Functions invoke</li>
                    <li>Lambda SDK calls</li>
                    <li>Knowledge Base queries</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí CloudWatch (metrics)</li>
                    <li>‚Üí S3 (responses)</li>
                    <li>‚Üê OpenSearch (RAG)</li>
                </ul>
                <div class="connection-list">
                    <strong>Models:</strong>
                    <li>Claude 3 (primary)</li>
                    <li>Llama 2 (fallback)</li>
                    <li>Titan Embeddings</li>
                    <li>Guardrails enabled</li>
                </div>
            </div>

            <!-- SageMaker -->
            <div class="service-card">
                <h3><span class="service-icon">SM</span> SageMaker</h3>
                <strong>Input:</strong>
                <ul>
                    <li>S3 training data</li>
                    <li>Step Functions triggers</li>
                    <li>EventBridge schedules</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí Model Registry</li>
                    <li>‚Üí Endpoints (REST)</li>
                    <li>‚Üí S3 (artifacts)</li>
                    <li>‚Üí CloudWatch (metrics)</li>
                </ul>
                <div class="connection-list">
                    <strong>Components:</strong>
                    <li>Training Jobs (ml.p3)</li>
                    <li>Endpoints (ml.m5)</li>
                    <li>Pipelines (MLOps)</li>
                    <li>Model Monitor</li>
                </div>
            </div>

            <!-- OpenSearch -->
            <div class="service-card">
                <h3><span class="service-icon">OS</span> OpenSearch</h3>
                <strong>Input:</strong>
                <ul>
                    <li>Lambda (bulk index)</li>
                    <li>Kinesis Firehose</li>
                    <li>Logstash pipelines</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí Lambda (search API)</li>
                    <li>‚Üí Bedrock (RAG)</li>
                    <li>‚Üí Dashboards</li>
                </ul>
                <div class="connection-list">
                    <strong>Config:</strong>
                    <li>3x r6g.large.search</li>
                    <li>k-NN plugin enabled</li>
                    <li>Index: 768-dim vectors</li>
                    <li>Snapshot to S3 daily</li>
                </div>
            </div>

            <!-- DynamoDB -->
            <div class="service-card">
                <h3><span class="service-icon">DB</span> DynamoDB</h3>
                <strong>Input:</strong>
                <ul>
                    <li>Lambda writes</li>
                    <li>API Gateway direct</li>
                    <li>Step Functions</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí Lambda (queries)</li>
                    <li>‚Üí Streams ‚Üí Lambda</li>
                    <li>‚Üí S3 (export)</li>
                    <li>‚Üí Kinesis (stream)</li>
                </ul>
                <div class="connection-list">
                    <strong>Tables:</strong>
                    <li>tickets (GSI: status)</li>
                    <li>idempotency (TTL)</li>
                    <li>sessions (TTL)</li>
                    <li>feedback</li>
                </div>
            </div>

            <!-- S3 Buckets -->
            <div class="service-card">
                <h3><span class="service-icon">S3</span> S3 Buckets</h3>
                <strong>Structure:</strong>
                <ul>
                    <li><code>raw/</code> - Input docs</li>
                    <li><code>processed/</code> - OCR output</li>
                    <li><code>models/</code> - ML artifacts</li>
                    <li><code>logs/</code> - App logs</li>
                    <li><code>kb/</code> - Knowledge base</li>
                </ul>
                <strong>Policies:</strong>
                <ul>
                    <li>Lifecycle: IA after 30d</li>
                    <li>Versioning enabled</li>
                    <li>Encryption: SSE-KMS</li>
                    <li>Replication: Cross-region</li>
                </ul>
                <div class="connection-list">
                    <strong>Access:</strong>
                    <li>VPC Endpoint</li>
                    <li>IAM roles only</li>
                    <li>CloudFront for static</li>
                </div>
            </div>

            <!-- EventBridge -->
            <div class="service-card">
                <h3><span class="service-icon">EB</span> EventBridge</h3>
                <strong>Input:</strong>
                <ul>
                    <li>Step Functions events</li>
                    <li>S3 events</li>
                    <li>Custom events</li>
                    <li>Scheduled rules</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí Lambda targets</li>
                    <li>‚Üí Step Functions</li>
                    <li>‚Üí SNS topics</li>
                    <li>‚Üí SQS queues</li>
                </ul>
                <div class="connection-list">
                    <strong>Rules:</strong>
                    <li>ticket.created</li>
                    <li>model.deployed</li>
                    <li>drift.detected</li>
                    <li>cron: retrain daily</li>
                </div>
            </div>

            <!-- Textract -->
            <div class="service-card">
                <h3><span class="service-icon">TX</span> Textract</h3>
                <strong>Input:</strong>
                <ul>
                    <li>S3 documents</li>
                    <li>Lambda invoke</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí S3 (JSON results)</li>
                    <li>‚Üí SNS (completion)</li>
                    <li>‚Üí Lambda (callback)</li>
                </ul>
                <div class="connection-list">
                    <strong>Features:</strong>
                    <li>Tables extraction</li>
                    <li>Forms processing</li>
                    <li>Async jobs for PDF</li>
                    <li>Confidence scores</li>
                </div>
            </div>

            <!-- CloudWatch -->
            <div class="service-card">
                <h3><span class="service-icon">CW</span> CloudWatch</h3>
                <strong>Input:</strong>
                <ul>
                    <li>All services logs</li>
                    <li>Custom metrics</li>
                    <li>X-Ray traces</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí SNS (alarms)</li>
                    <li>‚Üí Lambda (triggers)</li>
                    <li>‚Üí S3 (export)</li>
                    <li>‚Üí OpenSearch</li>
                </ul>
                <div class="connection-list">
                    <strong>Dashboards:</strong>
                    <li>API latency P50/P99</li>
                    <li>ML inference metrics</li>
                    <li>Error rates</li>
                    <li>Cost tracking</li>
                </div>
            </div>

            <!-- Cognito -->
            <div class="service-card">
                <h3><span class="service-icon">CO</span> Cognito</h3>
                <strong>Input:</strong>
                <ul>
                    <li>User registration</li>
                    <li>OAuth/SAML/OIDC</li>
                </ul>
                <strong>Output:</strong>
                <ul>
                    <li>‚Üí JWT tokens</li>
                    <li>‚Üí API Gateway auth</li>
                    <li>‚Üí Lambda triggers</li>
                </ul>
                <div class="connection-list">
                    <strong>Config:</strong>
                    <li>User Pool: 100K users</li>
                    <li>MFA enabled</li>
                    <li>Groups: admin, operator</li>
                    <li>Token expiry: 1h</li>
                </div>
            </div>
        </div>

        <h2>üìä Flussi Dati End-to-End</h2>
        
        <div class="flow-section">
            <h3>üé´ Flusso Ticket Processing</h3>
            <ol>
                <li><strong>Ingresso:</strong> ITSM ‚Üí SQS ‚Üí Lambda ‚Üí DynamoDB (stato: NEW)</li>
                <li><strong>Enrichment:</strong> Lambda ‚Üí Customer API ‚Üí DynamoDB (update metadata)</li>
                <li><strong>OCR Allegati:</strong> S3 ‚Üí Textract ‚Üí S3 (JSON) ‚Üí Lambda parsing</li>
                <li><strong>Classificazione:</strong> Step Functions ‚Üí SageMaker Endpoint ‚Üí DynamoDB (category)</li>
                <li><strong>RAG Retrieval:</strong> OpenSearch query ‚Üí top-k chunks ‚Üí ranking</li>
                <li><strong>Generazione:</strong> Bedrock (Claude) + context ‚Üí streaming response</li>
                <li><strong>Validazione:</strong> Guardrails ‚Üí safety check ‚Üí citation verification</li>
                <li><strong>Storage:</strong> DynamoDB (solution) + S3 (prompt/response log)</li>
                <li><strong>Notifica:</strong> EventBridge ‚Üí SNS ‚Üí Webhook/Email</li>
                <li><strong>Feedback:</strong> API ‚Üí Lambda ‚Üí DynamoDB ‚Üí training dataset</li>
            </ol>
        </div>

        <div class="flow-section">
            <h3>üìö Flusso Knowledge Base Update</h3>
            <ol>
                <li><strong>Upload:</strong> Wiki/Manual ‚Üí S3 bucket (trigger)</li>
                <li><strong>Processing:</strong> Lambda ‚Üí Textract (PDF) ‚Üí text extraction</li>
                <li><strong>Chunking:</strong> Lambda ‚Üí split (1000 tokens) ‚Üí metadata</li>
                <li><strong>Embedding:</strong> Bedrock Titan ‚Üí 768-dim vectors</li>
                <li><strong>Indexing:</strong> OpenSearch bulk API ‚Üí k-NN index</li>
                <li><strong>Validation:</strong> Test queries ‚Üí quality check</li>
                <li><strong>Activation:</strong> Update alias ‚Üí new index live</li>
            </ol>
        </div>

        <div class="flow-section">
            <h3>üîÑ Flusso Retraining Automatico</h3>
            <ol>
                <li><strong>Trigger:</strong> EventBridge (daily) OR drift detection alert</li>
                <li><strong>Data Prep:</strong> Athena query ‚Üí labeled tickets ‚Üí S3</li>
                <li><strong>Pipeline:</strong> SageMaker Pipeline ‚Üí preprocessing ‚Üí split</li>
                <li><strong>Training:</strong> BlazingText/BERT ‚Üí hyperparameter tuning</li>
                <li><strong>Evaluation:</strong> Test set ‚Üí F1 score ‚Üí threshold check</li>
                <li><strong>Registry:</strong> Model Registry ‚Üí approve/reject</li>
                <li><strong>Deploy:</strong> Blue/Green ‚Üí canary 10% ‚Üí monitor</li>
                <li><strong>Rollback:</strong> If metrics drop ‚Üí auto rollback</li>
            </ol>
        </div>

        <h2>‚öôÔ∏è Configurazioni Critiche</h2>

        <div class="legend">
            <div class="legend-item">
                <strong>üîÑ SQS Queues</strong>
                <li>Visibility timeout: 6x Lambda timeout</li>
                <li>Retention: 14 days</li>
                <li>DLQ after 3 retries</li>
                <li>Batch size: 10 messages</li>
            </div>
            
            <div class="legend-item">
                <strong>‚ö° Lambda Concurrency</strong>
                <li>API handlers: 100 reserved</li>
                <li>Processors: 50 reserved</li>
                <li>Background: unreserved</li>
                <li>Dead letter queue enabled</li>
            </div>
            
            <div class="legend-item">
                <strong>üóÑÔ∏è DynamoDB Capacity</strong>
                <li>Tickets: On-demand</li>
                <li>Idempotency: Provisioned 25/25</li>
                <li>Point-in-time recovery</li>
                <li>Global tables for DR</li>
            </div>
            
            <div class="legend-item">
                <strong>ü§ñ Bedrock Limits</strong>
                <li>Claude: 100 req/min</li>
                <li>Embeddings: 500 req/min</li>
                <li>Max tokens: 100K context</li>
                <li>Timeout: 120 seconds</li>
            </div>
            
            <div class="legend-item">
                <strong>üîç OpenSearch Sizing</strong>
                <li>Nodes: 3x r6g.large</li>
                <li>Storage: 100GB per node</li>
                <li>Shards: 5 primary, 1 replica</li>
                <li>Refresh: 30 seconds</li>
            </div>
            
            <div class="legend-item">
                <strong>üìä Monitoring Alarms</strong>
                <li>API latency > 1s</li>
                <li>Error rate > 1%</li>
                <li>DLQ messages > 10</li>
                <li>Model drift > threshold</li>
            </div>
        </div>

        <h2>üö® Punti di Integrazione Critici</h2>

        <div class="service-card" style="background: #ffebee; border-color: #f44336;">
            <h3 style="color: #f44336;">‚ö†Ô∏è Collegamenti Critici da Monitorare</h3>
            <ol>
                <li><strong>API Gateway ‚Üí Lambda:</strong> Timeout sync calls (29s max)</li>
                <li><strong>Lambda ‚Üí Bedrock:</strong> Rate limiting e retry con backoff</li>
                <li><strong>Step Functions ‚Üí SageMaker:</strong> Long running jobs monitoring</li>
                <li><strong>OpenSearch ‚Üí Bedrock:</strong> Latency retrieval impatta generazione</li>
                <li><strong>DynamoDB Streams ‚Üí Lambda:</strong> Batch size e parallelism</li>
                <li><strong>S3 ‚Üí Textract:</strong> Async jobs per file > 5MB</li>
                <li><strong>EventBridge ‚Üí Targets:</strong> Failed invocations to DLQ</li>
                <li><strong>Cognito ‚Üí API Gateway:</strong> Token refresh flow</li>
            </ol>
        </div>

        <h2>üìù Note Implementative</h2>
        
        <div class="connection-list">
            <h3>Best Practices</h3>
            <li><strong>Idempotency:</strong> Usa Idempotency Keys su tutte le operazioni write</li>
            <li><strong>Retry Logic:</strong> Exponential backoff con jitter su tutti i client SDK</li>
            <li><strong>Circuit Breaker:</strong> Implementa su chiamate a servizi esterni</li>
            <li><strong>Caching:</strong> CloudFront per static, ElastiCache per session data</li>
            <li><strong>Versioning:</strong> API versioning, model versioning, config versioning</li>
            <li><strong>Secrets:</strong> Rotation automatica ogni 30 giorni via Secrets Manager</li>
            <li><strong>Backup:</strong> Point-in-time recovery DynamoDB, snapshot OpenSearch</li>
            <li><strong>Disaster Recovery:</strong> Multi-region standby, RPO 1h, RTO 4h</li>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active from all buttons
            const buttons = document.querySelectorAll('.tab');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active to clicked button
            event.target.classList.add('active');
            
            // Re-render Mermaid diagrams
            mermaid.init();
        }
    </script>
</body>
</html>